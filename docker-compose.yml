version: '3'
services:
db:
  image: postgres:latest
  environment:
    POSTGRES_DB: captiveportal
    POSTGRES_USER: admin
    POSTGRES_PASSWORD: password123
  volumes:
    - postgres_data:/var/lib/postgresql/data
  network_mode: "host"

webapp:
  build:
    context: ./webapp
    network: host
  container_name: webapp 
  environment:
    SPRING_DATASOURCE_URL: jdbc:postgresql://localhost:5432/captiveportal
    SPRING_DATASOURCE_USERNAME: admin
    SPRING_DATASOURCE_PASSWORD: password123
  depends_on:
    - db
  network_mode: "host"
  dns:
    - 8.8.8.8
    - 8.8.4.4

router:
  build: 
    context: ./nginx
    network: host
  network_mode: "host"
  depends_on:
    - webapp
  dns:
    - 8.8.8.8
    - 8.8.4.4
  cap_add:
    - NET_ADMIN
  volumes:
    - ./nginx/logs:/var/log/nginx
  privileged: true

pc-client:
  build:
    context: ./pc-client
    network: host
  image: alpine:latest
  network_mode: "host"
  command: >
    sh -c "
    apk add --no-cache curl wget iputils lynx elinks w3m &&
    tail -f /dev/null"
  depends_on:
    - router
  dns:
    - 8.8.8.8
    - 8.8.4.4
  privileged: true

volumes:
postgres_data: